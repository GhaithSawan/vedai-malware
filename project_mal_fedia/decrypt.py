import os
from cryptography.fernet import Fernet

files = []

# Step 1: Collect files except "thekey.key" and "decrypt.py"
for file in os.listdir():
    if file in ("encrypt.py", "thekey.key", "decrypt.py"):
        continue
    if os.path.isfile(file):
        files.append(file)

print("Files to decrypt:", files)

# Step 2: Read the secret key from "thekey.key"
with open("thekey.key", "rb") as key_file:
    secret_key = key_file.read()
print(secret_key)
# Step 3: Initialize Fernet with the secret key
fernet = Fernet(secret_key)

# Step 4: Decrypt each file
for file in files:
    try:
        with open(file, "rb") as encrypted_file:
            encrypted_contents = encrypted_file.read()
        
        decrypted_contents = fernet.decrypt(encrypted_contents)
        
        # Write decrypted contents back to the file
        with open(file, "wb") as decrypted_file:
            decrypted_file.write(decrypted_contents)
        
        print(f"Decrypted {file} successfully.")
    except Exception as e:
        print(f"Failed to decrypt {file}: {e}")

print("Decryption complete.")
